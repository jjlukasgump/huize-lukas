<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Overzicht Zorg Huize Lukas</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const SUPABASE_URL = 'https://ljupvfenzalnqnulyrvg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqdXB2ZmVuemFsbnFudWx5cnZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjc3MDYsImV4cCI6MjA4NjkwMzcwNn0.86TB7rW3V7xSkWdc9C_l8Rt6PwQWliidrWGKk9-HsN8';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const USERS = {
      'JJ': 'catomoos',
      'Linda': 'mooscato'
    };

    const App = () => {
      const [currentUser, setCurrentUser] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const user = localStorage.getItem('huizelukas_user');
        if (user) setCurrentUser(JSON.parse(user));
        setLoading(false);
      }, []);

      const handleLogin = (naam, wachtwoord) => {
        if (USERS[naam] === wachtwoord) {
          const user = { naam };
          localStorage.setItem('huizelukas_user', JSON.stringify(user));
          setCurrentUser(user);
          return true;
        }
        return false;
      };

      const handleLogout = () => {
        localStorage.removeItem('huizelukas_user');
        setCurrentUser(null);
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center">
            <div className="text-center">
              <div className="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl mx-auto mb-4 animate-pulse"></div>
              <p className="text-gray-600 font-medium">Laden...</p>
            </div>
          </div>
        );
      }

      if (!currentUser) return <LoginScreen onLogin={handleLogin} />;
      return <MainApp currentUser={currentUser} onLogout={handleLogout} />;
    };

    const LoginScreen = ({ onLogin }) => {
      const [naam, setNaam] = useState('');
      const [wachtwoord, setWachtwoord] = useState('');
      const [error, setError] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        const success = onLogin(naam, wachtwoord);
        if (!success) {
          setError('Ongeldige gebruikersnaam of wachtwoord');
          setWachtwoord('');
        }
      };

      return (
        <div className="fixed inset-0 bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
            <div className="text-center mb-8">
              <div className="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
              </div>
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Welkom bij</h2>
              <p className="text-xl font-semibold text-indigo-600">Overzicht Zorg Huize Lukas</p>
              <p className="text-gray-600 mt-2">Log in om te beginnen</p>
            </div>
            <form onSubmit={handleSubmit} className="space-y-4">
              <div>
                <select value={naam} onChange={(e) => setNaam(e.target.value)} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                  <option value="">Selecteer gebruiker</option>
                  <option value="JJ">JJ</option>
                  <option value="Linda">Linda</option>
                </select>
              </div>
              <div>
                <input type="password" placeholder="Wachtwoord" value={wachtwoord} onChange={(e) => setWachtwoord(e.target.value)} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors" />
              </div>
              {error && <p className="text-red-600 text-sm">{error}</p>}
              <button type="submit" disabled={!naam || !wachtwoord} className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                Inloggen
              </button>
            </form>
          </div>
        </div>
      );
    };

    const MainApp = ({ currentUser, onLogout }) => {
      const [currentView, setCurrentView] = useState('dashboard');
      const [kinderen, setKinderen] = useState([]);
      const [trajecten, setTrajecten] = useState([]);
      const [actiepunten, setActiepunten] = useState([]);
      const [organisaties, setOrganisaties] = useState([]);
      const [contactpersonen, setContactpersonen] = useState([]);
      const [interacties, setInteracties] = useState([]);
      const [headerFoto, setHeaderFoto] = useState('');
      const [selectedTraject, setSelectedTraject] = useState(null);
      const [showModal, setShowModal] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [showCompleted, setShowCompleted] = useState(false);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        loadAllData();
      }, []);

      const loadAllData = async () => {
        try {
          const [kinderenData, trajectenData, actiepuntenData, organisatiesData, contactenData, interactiesData, settingsData] = await Promise.all([
            supabase.from('kinderen').select('*'),
            supabase.from('trajecten').select('*'),
            supabase.from('actiepunten').select('*'),
            supabase.from('organisaties').select('*'),
            supabase.from('contactpersonen').select('*'),
            supabase.from('interacties').select('*'),
            supabase.from('instellingen').select('*').eq('id', 'settings').single()
          ]);

          setKinderen(kinderenData.data || []);
          setTrajecten(trajectenData.data || []);
          setActiepunten(actiepuntenData.data || []);
          setOrganisaties(organisatiesData.data || []);
          setContactpersonen(contactenData.data || []);
          setInteracties(interactiesData.data || []);
          setHeaderFoto(settingsData.data?.header_foto || '');
        } catch (error) {
          console.error('Error loading data:', error);
        }
        setLoading(false);
      };

      const saveKind = async (kind) => {
        try {
          if (kind.id && kinderen.find(k => k.id === kind.id)) {
            await supabase.from('kinderen').update(kind).eq('id', kind.id);
            setKinderen(kinderen.map(k => k.id === kind.id ? kind : k));
          } else {
            const { data } = await supabase.from('kinderen').insert([kind]).select();
            setKinderen([...kinderen, data[0]]);
          }
          return true;
        } catch (error) {
          alert('Fout bij opslaan: ' + error.message);
          return false;
        }
      };

      const saveTraject = async (traject) => {
        try {
          if (traject.id && trajecten.find(t => t.id === traject.id)) {
            await supabase.from('trajecten').update(traject).eq('id', traject.id);
            setTrajecten(trajecten.map(t => t.id === traject.id ? traject : t));
          } else {
            const { data } = await supabase.from('trajecten').insert([traject]).select();
            setTrajecten([...trajecten, data[0]]);
          }
          return true;
        } catch (error) {
          alert('Fout bij opslaan: ' + error.message);
          return false;
        }
      };

      const saveActiepunt = async (actiepunt) => {
        try {
          if (actiepunt.id && actiepunten.find(a => a.id === actiepunt.id)) {
            await supabase.from('actiepunten').update(actiepunt).eq('id', actiepunt.id);
            setActiepunten(actiepunten.map(a => a.id === actiepunt.id ? actiepunt : a));
          } else {
            const { data } = await supabase.from('actiepunten').insert([actiepunt]).select();
            setActiepunten([...actiepunten, data[0]]);
          }
          return true;
        } catch (error) {
          alert('Fout bij opslaan: ' + error.message);
          return false;
        }
      };

      const saveHeaderFoto = async (foto) => {
        try {
          await supabase.from('instellingen').update({ header_foto: foto }).eq('id', 'settings');
          setHeaderFoto(foto);
          return true;
        } catch (error) {
          alert('Fout bij opslaan foto: ' + error.message);
          return false;
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-50 via-indigo-50 to-purple-50 flex items-center justify-center">
            <p className="text-gray-600">Laden...</p>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-50 via-indigo-50 to-purple-50">
          <div className="max-w-2xl mx-auto p-4">
            <Header currentUser={currentUser} onLogout={onLogout} />
            
            {currentView === 'dashboard' && (
              <Dashboard 
                kinderen={kinderen}
                trajecten={trajecten}
                actiepunten={actiepunten}
                headerFoto={headerFoto}
                searchTerm={searchTerm}
                setSearchTerm={setSearchTerm}
                showCompleted={showCompleted}
                setShowCompleted={setShowCompleted}
                setShowModal={setShowModal}
                saveActiepunt={saveActiepunt}
                saveHeaderFoto={saveHeaderFoto}
              />
            )}

            {currentView === 'kinderen' && (
              <KinderenView 
                kinderen={kinderen}
                trajecten={trajecten}
                actiepunten={actiepunten}
                setShowModal={setShowModal}
                setCurrentView={setCurrentView}
                setSelectedTraject={setSelectedTraject}
              />
            )}

            {currentView === 'trajecten' && (
              <TrajectenView 
                trajecten={trajecten}
                kinderen={kinderen}
                actiepunten={actiepunten}
                interacties={interacties}
                setShowModal={setShowModal}
                setCurrentView={setCurrentView}
                setSelectedTraject={setSelectedTraject}
              />
            )}

            <BottomNav currentView={currentView} setCurrentView={setCurrentView} setSelectedTraject={setSelectedTraject} />
            <FloatingActionButton setShowModal={setShowModal} />

            {showModal && (
              <ModalManager 
                showModal={showModal}
                setShowModal={setShowModal}
                currentUser={currentUser}
                kinderen={kinderen}
                trajecten={trajecten}
                organisaties={organisaties}
                saveKind={saveKind}
                saveTraject={saveTraject}
                saveActiepunt={saveActiepunt}
                saveHeaderFoto={saveHeaderFoto}
                headerFoto={headerFoto}
              />
            )}
          </div>
        </div>
      );
    };

    const Header = ({ currentUser, onLogout }) => (
      <div className="bg-white rounded-2xl shadow-sm p-4 mb-6 border-2 border-gray-100">
        <div className="flex justify-between items-center">
          <div>
            <p className="text-xs text-gray-500">Ingelogd als</p>
            <p className="font-semibold text-gray-900">{currentUser.naam}</p>
          </div>
          <button onClick={onLogout} className="text-sm text-gray-600 hover:text-gray-900 px-4 py-2 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors font-medium">
            Uitloggen
          </button>
        </div>
      </div>
    );

    const Dashboard = ({ kinderen, trajecten, actiepunten, headerFoto, searchTerm, setSearchTerm, showCompleted, setShowCompleted, setShowModal, saveActiepunt, saveHeaderFoto }) => {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const weekFromNow = new Date(today);
      weekFromNow.setDate(weekFromNow.getDate() + 7);

      let filteredActies = showCompleted ? actiepunten : actiepunten.filter(a => a.status !== 'afgerond');
      
      if (searchTerm) {
        filteredActies = filteredActies.filter(a => 
          a.omschrijving.toLowerCase().includes(searchTerm.toLowerCase())
        );
      }

      const overDatum = filteredActies.filter(a => {
        if (!a.deadline) return false;
        return new Date(a.deadline) < today;
      });

      const dezeWeek = filteredActies.filter(a => {
        if (!a.deadline) return false;
        const deadline = new Date(a.deadline);
        return deadline >= today && deadline <= weekFromNow;
      });

      const toggleComplete = async (actiepunt) => {
        const updated = { ...actiepunt, status: actiepunt.status === 'afgerond' ? 'open' : 'afgerond' };
        await saveActiepunt(updated);
      };

      return (
        <div className="space-y-6 pb-24">
          {headerFoto && (
            <div className="relative w-full h-48 rounded-2xl overflow-hidden shadow-lg">
              <img src={headerFoto} alt="Huize Lukas" className="w-full h-full object-cover" />
              <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end">
                <div className="p-6 w-full">
                  <h2 className="text-2xl font-bold text-white mb-1">Overzicht Zorg Huize Lukas</h2>
                </div>
              </div>
              <button onClick={() => setShowModal({ type: 'headerFoto' })} className="absolute top-4 right-4 bg-white/90 backdrop-blur-sm p-2 rounded-full hover:bg-white transition-colors">
                <svg className="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
              </button>
            </div>
          )}

          {!headerFoto && (
            <div onClick={() => setShowModal({ type: 'headerFoto' })} className="w-full h-32 rounded-2xl bg-gradient-to-br from-indigo-100 to-purple-100 border-2 border-dashed border-indigo-300 flex items-center justify-center cursor-pointer hover:border-indigo-400 transition-all">
              <div className="text-center">
                <svg className="w-8 h-8 text-indigo-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
                <p className="text-sm font-medium text-indigo-700">Voeg een gezinsfoto toe</p>
              </div>
            </div>
          )}

          <div>
            <div className="flex justify-between items-center mb-4">
              <h1 className="text-3xl font-bold text-gray-900">Dashboard</h1>
              <button onClick={() => setShowModal({ type: 'actiepunt' })} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg">
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
              </button>
            </div>

            <div className="bg-white p-4 rounded-2xl border-2 border-gray-100 space-y-3 mb-6">
              <div className="relative">
                <svg className="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input type="text" placeholder="Zoek actiepunten..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors" />
              </div>
              <button onClick={() => setShowCompleted(!showCompleted)} className={`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${showCompleted ? 'bg-indigo-100 text-indigo-700 border-2 border-indigo-200' : 'bg-gray-100 text-gray-700 border-2 border-gray-200'}`}>
                {showCompleted ? 'Verberg afgerond' : 'Toon afgerond'}
              </button>
            </div>
          </div>

          {overDatum.length > 0 && (
            <div className="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-2xl border-2 border-red-200">
              <h2 className="text-xl font-bold text-red-900 mb-4">‚ö†Ô∏è Over datum ({overDatum.length})</h2>
              <div className="space-y-3">
                {overDatum.map(a => (
                  <ActiepuntCard key={a.id} actiepunt={a} trajecten={trajecten} kinderen={kinderen} onClick={() => setShowModal({ type: 'actiepunt', data: a })} onToggle={() => toggleComplete(a)} />
                ))}
              </div>
            </div>
          )}

          {dezeWeek.length > 0 && (
            <div className="bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-2xl border-2 border-orange-200">
              <h2 className="text-xl font-bold text-orange-900 mb-4">üìÖ Deze week ({dezeWeek.length})</h2>
              <div className="space-y-3">
                {dezeWeek.map(a => (
                  <ActiepuntCard key={a.id} actiepunt={a} trajecten={trajecten} kinderen={kinderen} onClick={() => setShowModal({ type: 'actiepunt', data: a })} onToggle={() => toggleComplete(a)} />
                ))}
              </div>
            </div>
          )}

          {overDatum.length === 0 && dezeWeek.length === 0 && (
            <div className="text-center py-16 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200">
              <div className="bg-green-100 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center">
                <svg className="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <p className="text-2xl font-bold text-green-900 mb-2">Alles onder controle!</p>
              <p className="text-green-700">Geen openstaande actiepunten üéâ</p>
            </div>
          )}
        </div>
      );
    };

    const ActiepuntCard = ({ actiepunt, trajecten, kinderen, onClick, onToggle }) => {
      const traject = trajecten.find(t => t.id === actiepunt.traject_id);
      const kind = kinderen.find(k => k.id === traject?.kind_id);

      return (
        <div className="bg-white p-5 rounded-2xl border-2 border-gray-100 shadow-sm hover:shadow-lg transition-all">
          <div className="flex items-start gap-3">
            <button onClick={(e) => { e.stopPropagation(); onToggle(); }} className="mt-1">
              {actiepunt.status === 'afgerond' ? (
                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                </svg>
              ) : (
                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="3" y="3" width="18" height="18" rx="2" strokeWidth="2" />
                </svg>
              )}
            </button>
            
            <div className="flex-1 cursor-pointer" onClick={onClick}>
              <p className={`font-semibold text-gray-900 mb-1 ${actiepunt.status === 'afgerond' ? 'line-through text-gray-500' : ''}`}>
                {actiepunt.omschrijving}
              </p>
              <p className="text-sm text-gray-500">{traject?.naam} ‚Ä¢ {kind?.naam}</p>
              <div className="flex items-center gap-3 text-sm mt-2">
                {actiepunt.deadline && (
                  <span className="text-gray-600">{new Date(actiepunt.deadline).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' })}</span>
                )}
                <span className={`px-3 py-1 rounded-full text-xs font-medium ${actiepunt.eigenaar === 'wij' ? 'bg-indigo-50 text-indigo-700' : 'bg-gray-100 text-gray-700'}`}>
                  {actiepunt.toegewezen_aan || actiepunt.eigenaar}
                </span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const KinderenView = ({ kinderen, trajecten, actiepunten, setShowModal, setCurrentView, setSelectedTraject }) => (
      <div className="space-y-6 pb-24">
        <div className="flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Kinderen</h1>
            <p className="text-gray-600 mt-1">Beheer je kinderen en hun trajecten</p>
          </div>
          <button onClick={() => setShowModal({ type: 'kind' })} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg">
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
          </button>
        </div>

        <div className="grid gap-4">
          {kinderen.map(kind => {
            const kindTrajecten = trajecten.filter(t => t.kind_id === kind.id && t.status !== 'afgesloten');
            const kindActies = actiepunten.filter(a => {
              const traject = trajecten.find(t => t.id === a.traject_id);
              return traject?.kind_id === kind.id && a.status !== 'afgerond';
            });

            return (
              <div key={kind.id} className="bg-gradient-to-br from-white to-indigo-50 p-6 rounded-2xl border-2 border-indigo-100 shadow-sm hover:shadow-lg transition-all">
                <div className="flex justify-between items-start mb-4">
                  <div className="flex items-center gap-4">
                    <div className="bg-indigo-100 w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 overflow-hidden">
                      {kind.foto ? (
                        <img src={kind.foto} alt={kind.naam} className="w-full h-full object-cover" />
                      ) : (
                        <svg className="w-7 h-7 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                      )}
                    </div>
                    <div>
                      <h3 className="font-bold text-xl text-gray-900">{kind.naam}</h3>
                      {kind.geboortedatum && (
                        <p className="text-sm text-gray-600">{new Date(kind.geboortedatum).toLocaleDateString('nl-NL', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                      )}
                    </div>
                  </div>
                  <button onClick={() => setShowModal({ type: 'kind', data: kind })} className="text-indigo-600 px-4 py-2 bg-white rounded-xl border-2 border-indigo-200 hover:border-indigo-300 transition-colors">
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                  </button>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white p-4 rounded-xl border-2 border-gray-100">
                    <span className="text-2xl font-bold text-gray-900">{kindTrajecten.length}</span>
                    <p className="text-sm text-gray-600">Actieve trajecten</p>
                  </div>
                  <div className="bg-white p-4 rounded-xl border-2 border-gray-100">
                    <span className="text-2xl font-bold text-gray-900">{kindActies.length}</span>
                    <p className="text-sm text-gray-600">Openstaande acties</p>
                  </div>
                </div>

                {kindTrajecten.length > 0 && (
                  <div className="mt-4 pt-4 border-t-2 border-indigo-100">
                    <p className="text-xs font-semibold text-indigo-700 mb-2 uppercase tracking-wide">Actieve trajecten</p>
                    <div className="space-y-2">
                      {kindTrajecten.slice(0, 3).map(traject => (
                        <div key={traject.id} onClick={() => { setSelectedTraject(traject); setCurrentView('traject-detail'); }} className="flex items-center gap-2 text-sm text-indigo-600 cursor-pointer hover:text-indigo-800 bg-white p-2 rounded-lg hover:bg-indigo-50 transition-colors">
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                          </svg>
                          <span className="font-medium">{traject.naam}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            );
          })}
        </div>

        {kinderen.length === 0 && (
          <div className="text-center py-16 bg-gradient-to-br from-gray-50 to-indigo-50 rounded-2xl border-2 border-dashed border-gray-300">
            <div className="bg-gray-100 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center">
              <svg className="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <p className="text-xl font-semibold text-gray-900 mb-2">Nog geen kinderen toegevoegd</p>
            <p className="text-gray-600 mb-6">Begin met het toevoegen van je eerste kind</p>
            <button onClick={() => setShowModal({ type: 'kind' })} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg">
              Voeg eerste kind toe
            </button>
          </div>
        )}
      </div>
    );

    const TrajectenView = ({ trajecten, kinderen, actiepunten, interacties, setShowModal, setCurrentView, setSelectedTraject }) => {
      const actiefTrajecten = trajecten.filter(t => t.status === 'actief');

      return (
        <div className="space-y-6 pb-24">
          <div className="flex justify-between items-center">
            <div>
              <h1 className="text-3xl font-bold text-gray-900">Trajecten</h1>
              <p className="text-gray-600 mt-1">Overzicht van alle lopende zaken</p>
            </div>
            <button onClick={() => setShowModal({ type: 'traject' })} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>

          <div className="grid gap-4">
            {actiefTrajecten.map(traject => {
              const kind = kinderen.find(k => k.id === traject.kind_id);
              const trajectActies = actiepunten.filter(a => a.traject_id === traject.id && a.status !== 'afgerond');
              const trajectInteracties = interacties.filter(i => i.traject_id === traject.id);

              return (
                <div key={traject.id} onClick={() => { setSelectedTraject(traject); setCurrentView('traject-detail'); }} className="bg-white p-6 rounded-2xl border-2 border-gray-100 shadow-sm hover:shadow-lg hover:border-indigo-200 transition-all cursor-pointer">
                  <div className="flex justify-between items-start mb-4">
                    <div className="flex-1">
                      <h3 className="font-bold text-lg text-gray-900 mb-1">{traject.naam}</h3>
                      <div className="flex items-center gap-2 flex-wrap">
                        <span className="text-sm text-gray-600">{kind?.naam}</span>
                        <span className="text-gray-400">‚Ä¢</span>
                        <span className="text-xs bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full font-medium">Actief</span>
                      </div>
                    </div>
                    <svg className="w-6 h-6 text-gray-400 flex-shrink-0 ml-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                    </svg>
                  </div>
                  <div className="flex items-center gap-6 text-sm text-gray-600">
                    <span>{trajectActies.length} acties</span>
                    <span>‚Ä¢</span>
                    <span>{trajectInteracties.length} interacties</span>
                  </div>
                </div>
              );
            })}
          </div>

          {actiefTrajecten.length === 0 && (
            <div className="text-center py-16 bg-gradient-to-br from-gray-50 to-purple-50 rounded-2xl border-2 border-dashed border-gray-300">
              <div className="bg-gray-100 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center">
                <svg className="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <p className="text-xl font-semibold text-gray-900 mb-2">Nog geen actieve trajecten</p>
              <p className="text-gray-600 mb-6">Start met het aanmaken van je eerste traject</p>
              <button onClick={() => setShowModal({ type: 'traject' })} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg">
                Voeg eerste traject toe
              </button>
            </div>
          )}
        </div>
      );
    };

    const BottomNav = ({ currentView, setCurrentView, setSelectedTraject }) => {
      const navItems = [
        { id: 'dashboard', label: 'Dashboard', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },
        { id: 'kinderen', label: 'Kinderen', icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' },
        { id: 'trajecten', label: 'Trajecten', icon: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z' }
      ];

      return (
        <div className="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-100 shadow-2xl z-40">
          <div className="max-w-2xl mx-auto flex justify-around px-2">
            {navItems.map(item => {
              const isActive = currentView === item.id;
              return (
                <button key={item.id} onClick={() => { setCurrentView(item.id); setSelectedTraject(null); }} className={`flex flex-col items-center py-3 px-5 transition-all ${isActive ? 'text-indigo-600' : 'text-gray-500 hover:text-gray-700'}`}>
                  <div className={`p-2 rounded-xl transition-all ${isActive ? 'bg-indigo-100' : ''}`}>
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={item.icon} />
                    </svg>
                  </div>
                  <span className={`text-xs mt-1 font-medium ${isActive ? 'text-indigo-600' : 'text-gray-600'}`}>{item.label}</span>
                </button>
              );
            })}
          </div>
        </div>
      );
    };

    const FloatingActionButton = ({ setShowModal }) => {
      const [showMenu, setShowMenu] = useState(false);

      return (
        <div className="fixed bottom-24 right-6 z-30">
          {showMenu && (
            <div className="absolute bottom-16 right-0 bg-white rounded-2xl shadow-2xl border-2 border-gray-100 p-2 space-y-2 min-w-[180px]">
              <button onClick={() => { setShowModal({ type: 'actiepunt' }); setShowMenu(false); }} className="w-full flex items-center gap-3 px-4 py-3 hover:bg-indigo-50 rounded-xl transition-colors text-left">
                <svg className="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                </svg>
                <span className="font-medium text-gray-900">Actiepunt</span>
              </button>
              <button onClick={() => { setShowModal({ type: 'traject' }); setShowMenu(false); }} className="w-full flex items-center gap-3 px-4 py-3 hover:bg-indigo-50 rounded-xl transition-colors text-left">
                <svg className="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <span className="font-medium text-gray-900">Traject</span>
              </button>
            </div>
          )}
          <button onClick={() => setShowMenu(!showMenu)} className={`w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full shadow-2xl hover:shadow-3xl transition-all ${showMenu ? 'rotate-45' : ''}`}>
            <svg className="w-7 h-7 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
          </button>
        </div>
      );
    };

    const ModalManager = ({ showModal, setShowModal, currentUser, kinderen, trajecten, organisaties, saveKind, saveTraject, saveActiepunt, saveHeaderFoto, headerFoto }) => {
      if (showModal.type === 'kind') {
        return <KindModal kind={showModal.data} onClose={() => setShowModal(null)} onSave={saveKind} currentUser={currentUser} />;
      }
      if (showModal.type === 'traject') {
        return <TrajectModal traject={showModal.data} kinderen={kinderen} organisaties={organisaties} onClose={() => setShowModal(null)} onSave={saveTraject} currentUser={currentUser} />;
      }
      if (showModal.type === 'actiepunt') {
        return <ActiepuntModal actiepunt={showModal.data} trajecten={trajecten} kinderen={kinderen} onClose={() => setShowModal(null)} onSave={saveActiepunt} currentUser={currentUser} />;
      }
      if (showModal.type === 'headerFoto') {
        return <HeaderFotoModal onClose={() => setShowModal(null)} onSave={saveHeaderFoto} headerFoto={headerFoto} />;
      }
      return null;
    };

    const KindModal = ({ kind, onClose, onSave, currentUser }) => {
      const [formData, setFormData] = useState(kind || {
        id: Date.now().toString(),
        naam: '',
        geboortedatum: '',
        notities: '',
        foto: '',
        aangemaakt_door: currentUser.naam,
        aangemaakt_op: new Date().toISOString()
      });
      const [fotoLoading, setFotoLoading] = useState(false);

      const handleFotoUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 20 * 1024 * 1024) {
            alert(`Foto is te groot (${(file.size / (1024 * 1024)).toFixed(1)}MB). Maximaal 20MB.`);
            return;
          }
          if (!file.type.startsWith('image/')) {
            alert('Selecteer een afbeelding (JPG, PNG, etc.)');
            return;
          }
          setFotoLoading(true);
          const reader = new FileReader();
          reader.onload = (event) => {
            setFormData(prev => ({ ...prev, foto: event.target.result }));
            setFotoLoading(false);
          };
          reader.onerror = () => {
            alert('Er ging iets mis bij het laden van de foto.');
            setFotoLoading(false);
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSave = async () => {
        if (!formData.naam) return;
        const success = await onSave(formData);
        if (success) onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto">
          <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full my-8">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900">{kind ? 'Bewerk kind' : 'Nieuw kind'}</h2>
              <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg className="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div className="space-y-5">
              <div className="flex justify-center">
                <div className="relative">
                  <div className="w-32 h-32 rounded-2xl overflow-hidden bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center border-4 border-white shadow-lg">
                    {fotoLoading ? (
                      <div className="flex flex-col items-center gap-2">
                        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                        <span className="text-xs text-indigo-600 font-medium">Laden...</span>
                      </div>
                    ) : formData.foto ? (
                      <img src={formData.foto} alt="Kind foto" className="w-full h-full object-cover" />
                    ) : (
                      <svg className="w-16 h-16 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                    )}
                  </div>
                  <label className="absolute bottom-0 right-0 bg-indigo-600 text-white p-2 rounded-full cursor-pointer hover:bg-indigo-700 transition-colors shadow-lg">
                    <input type="file" accept="image/*" onChange={handleFotoUpload} className="hidden" disabled={fotoLoading} />
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                    </svg>
                  </label>
                  {formData.foto && !fotoLoading && (
                    <button onClick={() => setFormData({ ...formData, foto: '' })} className="absolute top-0 right-0 bg-red-500 text-white p-1.5 rounded-full hover:bg-red-600 transition-colors shadow-lg">
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  )}
                </div>
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Naam *</label>
                <input type="text" value={formData.naam} onChange={(e) => setFormData({ ...formData, naam: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors" />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Geboortedatum</label>
                <input type="date" value={formData.geboortedatum} onChange={(e) => setFormData({ ...formData, geboortedatum: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors" />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Notities</label>
                <textarea value={formData.notities} onChange={(e) => setFormData({ ...formData, notities: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors resize-none" rows={3} />
              </div>
              <button onClick={handleSave} disabled={!formData.naam} className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                Opslaan
              </button>
            </div>
          </div>
        </div>
      );
    };

    const TrajectModal = ({ traject, kinderen, organisaties, onClose, onSave, currentUser }) => {
      const [formData, setFormData] = useState(traject || {
        id: Date.now().toString(),
        naam: '',
        kind_id: '',
        organisatie_ids: [],
        status: 'actief',
        startdatum: new Date().toISOString().split('T')[0],
        omschrijving: '',
        aangemaakt_door: currentUser.naam,
        aangemaakt_op: new Date().toISOString()
      });

      const handleSave = async () => {
        if (!formData.naam || !formData.kind_id) return;
        const success = await onSave(formData);
        if (success) onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto">
          <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full my-8">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900">{traject ? 'Bewerk traject' : 'Nieuw traject'}</h2>
              <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg className="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div className="space-y-5">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Naam traject *</label>
                <input type="text" placeholder="bijv. Rolstoel aanvraag, WMO indicatie" value={formData.naam} onChange={(e) => setFormData({ ...formData, naam: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors" />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Voor kind *</label>
                <select value={formData.kind_id} onChange={(e) => setFormData({ ...formData, kind_id: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                  <option value="">Selecteer kind</option>
                  {kinderen.map(kind => (
                    <option key={kind.id} value={kind.id}>{kind.naam}</option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Omschrijving</label>
                <textarea value={formData.omschrijving} onChange={(e) => setFormData({ ...formData, omschrijving: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors resize-none" rows={3} />
              </div>
              <button onClick={handleSave} disabled={!formData.naam || !formData.kind_id} className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                Opslaan
              </button>
            </div>
          </div>
        </div>
      );
    };

    const ActiepuntModal = ({ actiepunt, trajecten, kinderen, onClose, onSave, currentUser }) => {
      const [formData, setFormData] = useState(actiepunt || {
        id: Date.now().toString(),
        traject_id: '',
        omschrijving: '',
        eigenaar: 'wij',
        toegewezen_aan: 'JJ',
        deadline: '',
        status: 'open',
        prioriteit: 'normaal',
        notities: '',
        aangemaakt_door: currentUser.naam,
        aangemaakt_op: new Date().toISOString()
      });

      const handleSave = async () => {
        if (!formData.traject_id || !formData.omschrijving) return;
        const success = await onSave(formData);
        if (success) onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto">
          <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full my-8">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900">{actiepunt ? 'Bewerk actiepunt' : 'Nieuw actiepunt'}</h2>
              <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg className="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div className="space-y-5">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Traject *</label>
                <select value={formData.traject_id} onChange={(e) => setFormData({ ...formData, traject_id: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                  <option value="">Selecteer traject</option>
                  {trajecten.filter(t => t.status !== 'afgesloten').map(traject => {
                    const kind = kinderen.find(k => k.id === traject.kind_id);
                    return (
                      <option key={traject.id} value={traject.id}>
                        {traject.naam} ({kind?.naam})
                      </option>
                    );
                  })}
                </select>
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Omschrijving *</label>
                <textarea value={formData.omschrijving} onChange={(e) => setFormData({ ...formData, omschrijving: e.target.value })} placeholder="Wat moet er gedaan worden?" className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors resize-none" rows={3} />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Eigenaar</label>
                <select value={formData.eigenaar} onChange={(e) => setFormData({ ...formData, eigenaar: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                  <option value="wij">Wij</option>
                  <option value="zij">Zij (instantie)</option>
                </select>
              </div>
              {formData.eigenaar === 'wij' && (
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">Toegewezen aan</label>
                  <select value={formData.toegewezen_aan} onChange={(e) => setFormData({ ...formData, toegewezen_aan: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                    <option value="JJ">JJ</option>
                    <option value="Linda">Linda</option>
                    <option value="Beide">Beide</option>
                  </select>
                </div>
              )}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Deadline</label>
                <input type="date" value={formData.deadline} onChange={(e) => setFormData({ ...formData, deadline: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors" />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Prioriteit</label>
                <select value={formData.prioriteit} onChange={(e) => setFormData({ ...formData, prioriteit: e.target.value })} className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                  <option value="laag">Laag</option>
                  <option value="normaal">Normaal</option>
                  <option value="hoog">Hoog</option>
                </select>
              </div>
              <button onClick={handleSave} disabled={!formData.traject_id || !formData.omschrijving} className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                Opslaan
              </button>
            </div>
          </div>
        </div>
      );
    };

    const HeaderFotoModal = ({ onClose, onSave, headerFoto }) => {
      const [tempFoto, setTempFoto] = useState(headerFoto);
      const [fotoLoading, setFotoLoading] = useState(false);

      const handleFotoUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 20 * 1024 * 1024) {
            alert(`Foto is te groot (${(file.size / (1024 * 1024)).toFixed(1)}MB). Maximaal 20MB.`);
            return;
          }
          if (!file.type.startsWith('image/')) {
            alert('Selecteer een afbeelding');
            return;
          }
          setFotoLoading(true);
          const reader = new FileReader();
          reader.onload = (event) => {
            setTempFoto(event.target.result);
            setFotoLoading(false);
          };
          reader.onerror = () => {
            alert('Er ging iets mis bij het laden van de foto.');
            setFotoLoading(false);
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSave = async () => {
        const success = await onSave(tempFoto);
        if (success) onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900">Header foto</h2>
              <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg className="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div className="space-y-5">
              <div className="relative w-full">
                <div className="w-full h-48 rounded-2xl overflow-hidden bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center border-4 border-white shadow-lg">
                  {fotoLoading ? (
                    <div className="flex flex-col items-center gap-2">
                      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                      <span className="text-xs text-indigo-600 font-medium">Laden...</span>
                    </div>
                  ) : tempFoto ? (
                    <img src={tempFoto} alt="Header foto" className="w-full h-full object-cover" />
                  ) : (
                    <div className="text-center p-4">
                      <svg className="w-16 h-16 text-indigo-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                      </svg>
                      <p className="text-sm text-gray-600">Upload een gezinsfoto</p>
                    </div>
                  )}
                </div>
                <label className="absolute bottom-4 right-4 bg-indigo-600 text-white p-3 rounded-full cursor-pointer hover:bg-indigo-700 transition-colors shadow-lg">
                  <input type="file" accept="image/*" onChange={handleFotoUpload} className="hidden" disabled={fotoLoading} />
                  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                  </svg>
                </label>
                {tempFoto && !fotoLoading && (
                  <button onClick={() => setTempFoto('')} className="absolute top-4 right-4 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors shadow-lg">
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                )}
              </div>
              <div className="flex gap-3">
                <button onClick={onClose} className="flex-1 px-4 py-3 border-2 border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors">
                  Annuleren
                </button>
                <button onClick={handleSave} className="flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg">
                  Opslaan
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
