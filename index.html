<!DOCTYPE html>

<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Overzicht Zorg Huize Lukas</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    const SUPABASE_URL = 'https://ljupvfenzalnqnulyrvg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqdXB2ZmVuemFsbnFudWx5cnZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjc3MDYsImV4cCI6MjA4NjkwMzcwNn0.86TB7rW3V7xSkWdc9C_l8Rt6PwQWliidrWGKk9-HsN8';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const USERS = { 'JJ': 'catomoos', 'Linda': 'mooscato' };
    const ORG_TYPES = ['Gemeente','Zorginstelling','School','Ziekenhuis','Verzekeraar','Thuiszorg','GGZ','MEE','Wijkteam','Anders'];

```
const inputCls = "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors text-base";
const inputSmCls = "w-full px-3 py-2.5 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors text-sm bg-white";
const labelCls = "block text-sm font-semibold text-gray-700 mb-2";
const btnPrimary = "w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl font-medium shadow-lg hover:from-indigo-600 hover:to-purple-700 transition-all";

// FIX 1: datumTekst helper ‚Äî YYYY-MM-DD naar DD-MM-JJJJ
const toDutchDate = (iso) => {
  if (!iso || iso.length < 10) return '';
  const [y,m,d] = iso.split('-');
  return `${d}-${m}-${y}`;
};

const ModalWrap = ({ onClose, title, children }) => (
  <div className="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm z-50 overflow-y-auto">
    <div className="min-h-full flex items-start justify-center p-4 pt-6 pb-20">
      <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-2xl font-bold text-gray-900">{title}</h2>
          <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors">
            <svg className="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
        {children}
      </div>
    </div>
  </div>
);

// ‚îÄ‚îÄ‚îÄ DOCUMENT VIEWER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DocViewer = ({ doc, onClose }) => {
  const isImg = doc.type?.includes('image');
  const isPdf = doc.type?.includes('pdf');
  return (
    <div className="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-[60] flex flex-col">
      <div className="flex items-center justify-between p-4 bg-white/10 text-white">
        <p className="font-semibold truncate flex-1 mr-4">{doc.naam}</p>
        <div className="flex gap-2 flex-shrink-0">
          <a href={doc.data} download={doc.naam} className="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-medium flex items-center gap-2">
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
            Download
          </a>
          <button onClick={onClose} className="p-2 bg-white/20 hover:bg-white/30 rounded-xl">
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
      </div>
      <div className="flex-1 overflow-auto flex items-center justify-center p-4">
        {isImg && <img src={doc.data} alt={doc.naam} className="max-w-full max-h-full rounded-xl shadow-2xl object-contain"/>}
        {isPdf && <iframe src={doc.data} className="w-full h-full rounded-xl bg-white" title={doc.naam}/>}
        {!isImg && !isPdf && (
          <div className="bg-white rounded-2xl p-10 text-center max-w-sm">
            <div className="text-6xl mb-4">üìé</div>
            <p className="font-bold text-gray-900 mb-2">{doc.naam}</p>
            <p className="text-sm text-gray-500 mb-6">Preview niet beschikbaar voor dit bestandstype.</p>
            <a href={doc.data} download={doc.naam} className={btnPrimary + " inline-block"}>Download bestand</a>
          </div>
        )}
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const App = () => {
  const [currentUser, setCurrentUser] = useState(null);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    const u = localStorage.getItem('huizelukas_user');
    if (u) setCurrentUser(JSON.parse(u));
    setLoading(false);
  }, []);
  const handleLogin = (naam, ww) => {
    if (USERS[naam] === ww) {
      const u = { naam };
      localStorage.setItem('huizelukas_user', JSON.stringify(u));
      setCurrentUser(u); return true;
    }
    return false;
  };
  const handleLogout = () => { localStorage.removeItem('huizelukas_user'); setCurrentUser(null); };
  if (loading) return <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 flex items-center justify-center"><div className="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl animate-pulse mx-auto"></div></div>;
  if (!currentUser) return <LoginScreen onLogin={handleLogin} />;
  return <MainApp currentUser={currentUser} onLogout={handleLogout} />;
};

const LoginScreen = ({ onLogin }) => {
  const [naam, setNaam] = useState('');
  const [ww, setWw] = useState('');
  const [error, setError] = useState('');
  const handle = (e) => { e.preventDefault(); if (!onLogin(naam, ww)) { setError('Ongeldige gebruikersnaam of wachtwoord'); setWw(''); } };
  return (
    <div className="fixed inset-0 bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
        <div className="text-center mb-8">
          <div className="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
            <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          </div>
          <h2 className="text-2xl font-bold text-gray-900 mb-1">Welkom bij</h2>
          <p className="text-xl font-semibold text-indigo-600">Overzicht Zorg Huize Lukas</p>
        </div>
        <form onSubmit={handle} className="space-y-4">
          <select value={naam} onChange={e=>setNaam(e.target.value)} className={inputCls}>
            <option value="">Selecteer gebruiker</option>
            <option value="JJ">JJ</option>
            <option value="Linda">Linda</option>
          </select>
          <input type="password" placeholder="Wachtwoord" value={ww} onChange={e=>setWw(e.target.value)} className={inputCls} />
          {error && <p className="text-red-600 text-sm">{error}</p>}
          <button type="submit" disabled={!naam||!ww} className={btnPrimary + " disabled:opacity-50 disabled:cursor-not-allowed"}>Inloggen</button>
        </form>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MainApp = ({ currentUser, onLogout }) => {
  const [view, setView] = useState('dashboard');
  const [kinderen, setKinderen] = useState([]);
  const [trajecten, setTrajecten] = useState([]);
  const [actiepunten, setActiepunten] = useState([]);
  const [organisaties, setOrganisaties] = useState([]);
  const [afspraken, setAfspraken] = useState([]);
  const [documenten, setDocumenten] = useState([]);
  const [headerFoto, setHeaderFoto] = useState('');
  const [modal, setModal] = useState(null);
  const [search, setSearch] = useState('');
  const [showDone, setShowDone] = useState(false);
  const [loading, setLoading] = useState(true);
  const [viewerDoc, setViewerDoc] = useState(null); // FIX: doc viewer state

  useEffect(() => { loadAll(); }, []);

  useEffect(() => {
    let t;
    const reset = () => { clearTimeout(t); t = setTimeout(() => { localStorage.removeItem('huizelukas_user'); onLogout(); }, 10*60*1000); };
    const evts = ['click','touchstart','keydown','scroll'];
    evts.forEach(e => window.addEventListener(e, reset));
    reset();
    return () => { clearTimeout(t); evts.forEach(e => window.removeEventListener(e, reset)); };
  }, []);

  const loadAll = async () => {
    try {
      const [k,t,a,o,af,d,s] = await Promise.all([
        supabase.from('kinderen').select('*'),
        supabase.from('trajecten').select('*'),
        supabase.from('actiepunten').select('*'),
        supabase.from('organisaties').select('*'),
        supabase.from('afspraken').select('*'),
        supabase.from('documenten').select('*'),
        supabase.from('instellingen').select('*').eq('id','settings').single()
      ]);
      setKinderen(k.data||[]); setTrajecten(t.data||[]); setActiepunten(a.data||[]);
      setOrganisaties(o.data||[]); setAfspraken(af.data||[]);
      setDocumenten(d.data||[]); setHeaderFoto(s.data?.header_foto||'');
    } catch(e) { console.error(e); }
    setLoading(false);
  };

  const clean = obj => Object.fromEntries(Object.entries(obj).filter(([,v]) => v !== '' && v !== null && v !== undefined));

  // FIX 5: gebruik functionele setter voor setList zodat stale closure geen probleem is
  const makeSave = (table, setList) => async (item) => {
    try {
      const c = clean(item);
      if (item.id) {
        // probeer update, als geen rij gevonden doe insert
        const { data: existing } = await supabase.from(table).select('id').eq('id', item.id).single();
        if (existing) {
          const {error} = await supabase.from(table).update(c).eq('id', item.id);
          if (error) throw error;
          setList(prev => prev.map(x => x.id === item.id ? item : x));
        } else {
          const {data, error} = await supabase.from(table).insert([c]).select();
          if (error) throw error;
          setList(prev => [...prev, data&&data[0] ? data[0] : item]);
        }
      } else {
        const {data, error} = await supabase.from(table).insert([c]).select();
        if (error) throw error;
        setList(prev => [...prev, data&&data[0] ? data[0] : item]);
      }
      return true;
    } catch(e) { alert('Fout bij opslaan: '+e.message); return false; }
  };

  const makeDelete = (table, setList) => async (id) => {
    try {
      const {error} = await supabase.from(table).delete().eq('id', id);
      if (error) throw error;
      setList(prev => prev.filter(x => x.id !== id)); return true;
    } catch(e) { alert('Fout bij verwijderen: '+e.message); return false; }
  };

  const saveKind        = makeSave('kinderen', setKinderen);
  const saveTraject     = makeSave('trajecten', setTrajecten);
  const saveActiepunt   = makeSave('actiepunten', setActiepunten);
  const saveOrganisatie = makeSave('organisaties', setOrganisaties);
  const saveAfspraak    = makeSave('afspraken', setAfspraken);
  const saveDocument    = makeSave('documenten', setDocumenten);
  const delOrganisatie  = makeDelete('organisaties', setOrganisaties);
  const delAfspraak     = makeDelete('afspraken', setAfspraken);
  const delDocument     = makeDelete('documenten', setDocumenten);
  // FIX 3: actiepunten kunnen nu ook verwijderd worden
  const delActiepunt    = makeDelete('actiepunten', setActiepunten);

  const saveHeaderFoto = async (foto) => {
    try {
      await supabase.from('instellingen').update({header_foto: foto}).eq('id', 'settings');
      setHeaderFoto(foto); return true;
    } catch(e) { alert('Fout: '+e.message); return false; }
  };

  const exportData = () => {
    const data = { exportdatum: new Date().toISOString(), kinderen, trajecten, actiepunten, organisaties, afspraken };
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `huize-lukas-backup-${new Date().toISOString().split('T')[0]}.json`;
    a.click(); URL.revokeObjectURL(url);
  };

  if (loading) return <div className="min-h-screen flex items-center justify-center"><p className="text-gray-500">Laden...</p></div>;

  const props = { kinderen, trajecten, actiepunten, organisaties, afspraken, documenten, setModal, saveActiepunt, delActiepunt, saveDocument, delDocument, currentUser, setViewerDoc };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-indigo-50 to-purple-50">
      <div className="max-w-2xl mx-auto p-4">
        <div className="bg-white rounded-2xl shadow-sm p-4 mb-6 border-2 border-gray-100">
          <div className="flex justify-between items-center">
            <div><p className="text-xs text-gray-500">Ingelogd als</p><p className="font-semibold text-gray-900">{currentUser.naam}</p></div>
            <div className="flex gap-2">
              <button onClick={exportData} title="Backup downloaden" className="text-sm px-3 py-2 bg-gray-50 rounded-xl hover:bg-gray-100 font-medium">üíæ</button>
              <button onClick={onLogout} className="text-sm text-gray-600 px-4 py-2 bg-gray-50 rounded-xl hover:bg-gray-100 font-medium">Uitloggen</button>
            </div>
          </div>
        </div>

        {view==='dashboard'    && <Dashboard {...props} headerFoto={headerFoto} search={search} setSearch={setSearch} showDone={showDone} setShowDone={setShowDone} saveHeaderFoto={saveHeaderFoto} />}
        {view==='kinderen'     && <KinderenView {...props} />}
        {view==='trajecten'    && <TrajectenView {...props} />}
        {view==='afspraken'    && <AfsprakenView {...props} onDelAfspraak={delAfspraak} />}
        {view==='organisaties' && <OrganisatiesView {...props} onDelOrg={delOrganisatie} />}

        <BottomNav view={view} setView={setView} />
        <FAB setModal={setModal} view={view} />

        {modal && <ModalManager modal={modal} setModal={setModal} currentUser={currentUser}
          kinderen={kinderen} trajecten={trajecten} organisaties={organisaties}
          saveKind={saveKind} saveTraject={saveTraject} saveActiepunt={saveActiepunt}
          saveOrganisatie={saveOrganisatie} saveAfspraak={saveAfspraak}
          saveHeaderFoto={saveHeaderFoto} headerFoto={headerFoto} />}

        {viewerDoc && <DocViewer doc={viewerDoc} onClose={()=>setViewerDoc(null)} />}
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Dashboard = ({ kinderen, trajecten, actiepunten, afspraken, headerFoto, search, setSearch, showDone, setShowDone, setModal, saveActiepunt, delActiepunt, saveHeaderFoto }) => {
  const today = new Date(); today.setHours(0,0,0,0);
  const week  = new Date(today); week.setDate(week.getDate()+7);
  const parseDate = (str) => { if(!str) return null; const [y,m,d]=str.split('-'); return new Date(+y, +m-1, +d); };

  let list = showDone ? actiepunten : actiepunten.filter(a=>a.status!=='afgerond');
  if (search) list = list.filter(a=>a.omschrijving?.toLowerCase().includes(search.toLowerCase()));

  const over   = list.filter(a=>{ const d=parseDate(a.deadline); return d&&d<today&&a.status!=='afgerond'; });
  const dezeWk = list.filter(a=>{ const d=parseDate(a.deadline); return d&&d>=today&&d<=week; });
  // FIX 6: guard op lege datum
  const komend = [...afspraken].filter(a=>{ if(!a.datum) return false; const d=new Date(a.datum+'T'+(a.tijd||'00:00')); return !isNaN(d)&&d>=today&&a.status!=='geannuleerd'; }).sort((a,b)=>new Date(a.datum+'T'+(a.tijd||'00:00'))-new Date(b.datum+'T'+(b.tijd||'00:00'))).slice(0,3);

  const toggle = async (a) => saveActiepunt({...a, status: a.status==='afgerond'?'open':'afgerond'});

  return (
    <div className="space-y-6 pb-24">
      {headerFoto ? (
        <div className="relative w-full h-48 rounded-2xl overflow-hidden shadow-lg">
          <img src={headerFoto} alt="Huize Lukas" className="w-full h-full object-cover"/>
          <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end">
            <div className="p-6"><h2 className="text-2xl font-bold text-white">Overzicht Zorg Huize Lukas</h2></div>
          </div>
          <button onClick={()=>setModal({type:'headerFoto'})} className="absolute top-4 right-4 bg-white/90 p-2 rounded-full hover:bg-white">
            <svg className="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
          </button>
        </div>
      ) : (
        <div onClick={()=>setModal({type:'headerFoto'})} className="w-full h-32 rounded-2xl bg-gradient-to-br from-indigo-100 to-purple-100 border-2 border-dashed border-indigo-300 flex items-center justify-center cursor-pointer hover:border-indigo-400">
          <div className="text-center">
            <svg className="w-8 h-8 text-indigo-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
            <p className="text-sm font-medium text-indigo-700">Voeg een gezinsfoto toe</p>
          </div>
        </div>
      )}

      {komend.length>0 && (
        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-2xl border-2 border-blue-200">
          <h2 className="text-lg font-bold text-blue-900 mb-3">üìÖ Komende afspraken</h2>
          <div className="space-y-2">
            {komend.map(af=>{
              const kind = kinderen.find(k=>k.id===af.kind_id);
              const d = new Date(af.datum+'T'+(af.tijd||'00:00'));
              return (
                <div key={af.id} onClick={()=>setModal({type:'afspraak',data:af})} className="bg-white p-3 rounded-xl flex items-center gap-3 cursor-pointer hover:shadow-md transition-all">
                  <div className="bg-blue-100 text-blue-700 rounded-xl p-2 text-center min-w-[48px]">
                    <p className="text-xs font-bold uppercase">{d.toLocaleDateString('nl-NL',{month:'short'})}</p>
                    <p className="text-lg font-bold leading-none">{d.getDate()}</p>
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="font-semibold text-gray-900 text-sm truncate">{af.titel}</p>
                    <p className="text-xs text-gray-500">{af.tijd&&af.tijd+' '}{kind&&'‚Ä¢ '+kind.naam}{af.locatie&&' ‚Ä¢ '+af.locatie}</p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      )}

      <div>
        <div className="flex justify-between items-center mb-4">
          <h1 className="text-3xl font-bold text-gray-900">Dashboard</h1>
          <button onClick={()=>setModal({type:'actiepunt'})} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl shadow-lg">
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
          </button>
        </div>
        <div className="bg-white p-4 rounded-2xl border-2 border-gray-100 space-y-3 mb-4">
          <div className="relative">
            <svg className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            <input type="text" placeholder="Zoek actiepunten..." value={search} onChange={e=>setSearch(e.target.value)} className="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none"/>
          </div>
          <button onClick={()=>setShowDone(!showDone)} className={`px-4 py-2 rounded-xl text-sm font-medium border-2 transition-colors ${showDone?'bg-indigo-100 text-indigo-700 border-indigo-200':'bg-gray-100 text-gray-700 border-gray-200'}`}>
            {showDone?'Verberg afgerond':'Toon afgerond'}
          </button>
        </div>
      </div>

      {over.length>0 && (
        <div className="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-2xl border-2 border-red-200">
          <h2 className="text-xl font-bold text-red-900 mb-4">‚ö†Ô∏è Over datum ({over.length})</h2>
          <div className="space-y-3">{over.map(a=><APCard key={a.id} a={a} trajecten={trajecten} kinderen={kinderen} onEdit={()=>setModal({type:'actiepunt',data:a})} onToggle={()=>toggle(a)} onDelete={()=>delActiepunt(a.id)}/>)}</div>
        </div>
      )}
      {dezeWk.length>0 && (
        <div className="bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-2xl border-2 border-orange-200">
          <h2 className="text-xl font-bold text-orange-900 mb-4">üìÖ Deze week ({dezeWk.length})</h2>
          <div className="space-y-3">{dezeWk.map(a=><APCard key={a.id} a={a} trajecten={trajecten} kinderen={kinderen} onEdit={()=>setModal({type:'actiepunt',data:a})} onToggle={()=>toggle(a)} onDelete={()=>delActiepunt(a.id)}/>)}</div>
        </div>
      )}
      {over.length===0&&dezeWk.length===0&&(
        <div className="text-center py-16 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200">
          <div className="bg-green-100 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center">
            <svg className="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>
          </div>
          <p className="text-2xl font-bold text-green-900 mb-2">Alles onder controle!</p>
          <p className="text-green-700">Geen openstaande actiepunten üéâ</p>
        </div>
      )}
    </div>
  );
};

const APCard = ({ a, trajecten, kinderen, onEdit, onToggle, onDelete }) => {
  const t = trajecten.find(x=>x.id===a.traject_id);
  const k = kinderen.find(x=>x.id===t?.kind_id);
  return (
    <div className="bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-sm">
      <div className="flex items-start gap-3">
        <button onClick={e=>{e.stopPropagation();onToggle();}} className="mt-1 flex-shrink-0">
          {a.status==='afgerond'
            ?<svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/></svg>
            :<svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" strokeWidth="2"/></svg>}
        </button>
        <div className="flex-1 cursor-pointer" onClick={onEdit}>
          <p className={`font-semibold text-gray-900 mb-1 ${a.status==='afgerond'?'line-through text-gray-400':''}`}>{a.omschrijving}</p>
          <p className="text-sm text-gray-500">{t?.naam}{k&&' ‚Ä¢ '+k.naam}</p>
          <div className="flex items-center gap-2 mt-2 flex-wrap">
            {a.deadline&&<span className="text-xs text-gray-500">{new Date(a.deadline).toLocaleDateString('nl-NL',{day:'numeric',month:'short'})}</span>}
            <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${a.eigenaar==='wij'?'bg-indigo-50 text-indigo-700':'bg-gray-100 text-gray-600'}`}>{a.toegewezen_aan||a.eigenaar}</span>
            {a.prioriteit==='hoog'&&<span className="px-2 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-600">Hoog</span>}
          </div>
        </div>
        {/* FIX 3: verwijderknop op actiepunt */}
        <button onClick={e=>{e.stopPropagation();if(confirm('Actiepunt verwijderen?')) onDelete();}} className="mt-1 p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg flex-shrink-0">
          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
        </button>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ KINDEREN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const KinderenView = ({ kinderen, trajecten, actiepunten, setModal }) => (
  <div className="space-y-6 pb-24">
    <div className="flex justify-between items-center">
      <div><h1 className="text-3xl font-bold text-gray-900">Kinderen</h1><p className="text-gray-600 mt-1">Beheer je kinderen</p></div>
      <button onClick={()=>setModal({type:'kind'})} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl shadow-lg">
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
      </button>
    </div>
    <div className="grid gap-4">
      {kinderen.map(kind=>{
        const kt = trajecten.filter(t=>t.kind_id===kind.id&&t.status!=='afgesloten');
        const ka = actiepunten.filter(a=>{ const t=trajecten.find(t=>t.id===a.traject_id); return t?.kind_id===kind.id&&a.status!=='afgerond'; });
        return (
          <div key={kind.id} className="bg-gradient-to-br from-white to-indigo-50 p-6 rounded-2xl border-2 border-indigo-100 shadow-sm">
            <div className="flex justify-between items-start mb-4">
              <div className="flex items-center gap-4">
                <div className="bg-indigo-100 w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 overflow-hidden">
                  {kind.foto?<img src={kind.foto} alt={kind.naam} className="w-full h-full object-cover"/>:<svg className="w-7 h-7 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>}
                </div>
                <div>
                  <h3 className="font-bold text-xl text-gray-900">{kind.naam}</h3>
                  {kind.geboortedatum&&<p className="text-sm text-gray-600">{new Date(kind.geboortedatum).toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'})}</p>}
                </div>
              </div>
              <button onClick={()=>setModal({type:'kind',data:kind})} className="p-2 text-indigo-600 bg-white rounded-xl border-2 border-indigo-200 hover:border-indigo-300">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
              </button>
            </div>
            <div className="grid grid-cols-2 gap-4 mb-3">
              <div className="bg-white p-4 rounded-xl border-2 border-gray-100"><span className="text-2xl font-bold text-gray-900">{kt.length}</span><p className="text-sm text-gray-600">Actieve trajecten</p></div>
              <div className="bg-white p-4 rounded-xl border-2 border-gray-100"><span className="text-2xl font-bold text-gray-900">{ka.length}</span><p className="text-sm text-gray-600">Openstaande acties</p></div>
            </div>
            {kind.notities&&(
              <div className="pt-3 border-t-2 border-indigo-100">
                <p className="text-xs font-semibold text-indigo-700 uppercase tracking-wide mb-1">Notities</p>
                <p className="text-sm text-gray-700 whitespace-pre-wrap">{kind.notities}</p>
              </div>
            )}
          </div>
        );
      })}
    </div>
    {kinderen.length===0&&<EmptyState msg="Nog geen kinderen toegevoegd" onAdd={()=>setModal({type:'kind'})} btnTxt="Voeg eerste kind toe"/>}
  </div>
);

// ‚îÄ‚îÄ‚îÄ TRAJECTEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TrajectenView = ({ trajecten, kinderen, actiepunten, organisaties, documenten, setModal, saveActiepunt, saveDocument, delDocument, currentUser, setViewerDoc }) => {
  const actief = trajecten.filter(t=>t.status==='actief');
  return (
    <div className="space-y-6 pb-24">
      <div className="flex justify-between items-center">
        <div><h1 className="text-3xl font-bold text-gray-900">Trajecten</h1><p className="text-gray-600 mt-1">Lopende zaken</p></div>
        <button onClick={()=>setModal({type:'traject'})} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl shadow-lg">
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
        </button>
      </div>
      <div className="grid gap-4">
        {actief.map(tr=>{
          const kind = kinderen.find(k=>k.id===tr.kind_id);
          const acties = actiepunten.filter(a=>a.traject_id===tr.id&&a.status!=='afgerond');
          const orgs = organisaties.filter(o=>(tr.organisatie_ids||[]).includes(o.id));
          const docs = documenten.filter(d=>d.traject_id===tr.id);
          return (
            <div key={tr.id} className="bg-white p-6 rounded-2xl border-2 border-gray-100 shadow-sm hover:shadow-lg transition-all">
              <div className="flex justify-between items-start mb-3">
                <div className="flex-1 cursor-pointer" onClick={()=>setModal({type:'traject',data:tr})}>
                  <h3 className="font-bold text-lg text-gray-900 mb-1">{tr.naam}</h3>
                  <div className="flex items-center gap-2 flex-wrap">
                    {kind&&<span className="text-sm text-gray-600">{kind.naam}</span>}
                    <span className="text-xs bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full font-medium">Actief</span>
                  </div>
                </div>
                <button onClick={()=>setModal({type:'actiepunt',data:{traject_id:tr.id}})} className="flex items-center gap-1 bg-indigo-50 text-indigo-700 border border-indigo-200 px-3 py-2 rounded-xl text-sm font-medium hover:bg-indigo-100 flex-shrink-0 ml-3">
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>Actie
                </button>
              </div>
              {orgs.length>0&&<div className="flex flex-wrap gap-2 mb-3">{orgs.map(o=><span key={o.id} className="text-xs bg-emerald-50 text-emerald-700 px-2 py-1 rounded-full font-medium border border-emerald-200">{o.naam}</span>)}</div>}
              {acties.length>0&&(
                <div className="space-y-1 mb-3">
                  {acties.slice(0,3).map(a=>(
                    <div key={a.id} onClick={()=>setModal({type:'actiepunt',data:a})} className="flex items-center gap-2 cursor-pointer hover:bg-gray-50 px-2 py-1 rounded-lg">
                      <svg className="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" strokeWidth="2"/></svg>
                      <span className="text-sm text-gray-700 truncate flex-1">{a.omschrijving}</span>
                      {a.deadline&&<span className="text-xs text-gray-400 flex-shrink-0">{new Date(a.deadline).toLocaleDateString('nl-NL',{day:'numeric',month:'short'})}</span>}
                    </div>
                  ))}
                  {acties.length>3&&<p className="text-xs text-indigo-600 font-medium px-2">+{acties.length-3} meer</p>}
                </div>
              )}
              <div className="pt-3 border-t border-gray-100">
                <DocSectie traject={tr} docs={docs} saveDocument={saveDocument} delDocument={delDocument} currentUser={currentUser} onView={setViewerDoc}/>
              </div>
            </div>
          );
        })}
      </div>
      {actief.length===0&&<EmptyState msg="Nog geen actieve trajecten" onAdd={()=>setModal({type:'traject'})} btnTxt="Voeg eerste traject toe"/>}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ DOC SECTIE (met viewer) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DocSectie = ({ traject, docs, saveDocument, delDocument, currentUser, onView }) => {
  const [open, setOpen] = useState(false);
  const [uploading, setUploading] = useState(false);
  const handleUpload = (e) => {
    const file = e.target.files[0]; if(!file) return;
    if(file.size>10*1024*1024){alert('Bestand te groot (max 10MB)');return;}
    setUploading(true);
    const reader = new FileReader();
    reader.onload = async (ev) => {
      await saveDocument({ id:Date.now().toString(), traject_id:traject.id, naam:file.name, type:file.type, grootte:file.size, data:ev.target.result, aangemaakt_door:currentUser.naam, aangemaakt_op:new Date().toISOString() });
      setUploading(false);
    };
    reader.onerror=()=>{alert('Fout bij laden bestand');setUploading(false);};
    reader.readAsDataURL(file);
    e.target.value='';
  };
  const icon = (t) => t?.includes('pdf')?'üìÑ':t?.includes('image')?'üñºÔ∏è':t?.includes('word')||t?.includes('document')?'üìù':'üìé';
  const fmtSize = (b) => !b?'':b<1024?b+'B':b<1024*1024?(b/1024).toFixed(0)+'KB':(b/(1024*1024)).toFixed(1)+'MB';
  return (
    <div>
      <div className="flex items-center justify-between mb-2">
        <button onClick={()=>setOpen(!open)} className="flex items-center gap-2 text-sm font-semibold text-gray-600 hover:text-gray-900">
          <svg className={`w-4 h-4 transition-transform ${open?'rotate-90':''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg>
          üìÅ Documenten ({docs.length})
        </button>
        <label className={`text-xs bg-gray-50 text-gray-600 border border-gray-200 px-3 py-1.5 rounded-lg cursor-pointer hover:bg-gray-100 ${uploading?'opacity-50':''}`}>
          {uploading?'Uploaden...':'+ Toevoegen'}
          <input type="file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif" onChange={handleUpload} className="hidden" disabled={uploading}/>
        </label>
      </div>
      {open&&(
        <div className="space-y-2 mt-2">
          {docs.map(doc=>(
            <div key={doc.id} className="flex items-center gap-3 bg-gray-50 p-3 rounded-xl">
              <span className="text-xl flex-shrink-0">{icon(doc.type)}</span>
              {/* FIX: klikbaar voor viewer */}
              <button onClick={()=>onView(doc)} className="flex-1 min-w-0 text-left hover:text-indigo-700">
                <p className="text-sm font-medium text-gray-900 truncate hover:text-indigo-700">{doc.naam}</p>
                <p className="text-xs text-gray-500">{fmtSize(doc.grootte)} ‚Ä¢ {new Date(doc.aangemaakt_op).toLocaleDateString('nl-NL')}</p>
              </button>
              <a href={doc.data} download={doc.naam} onClick={e=>e.stopPropagation()} className="p-1.5 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 flex-shrink-0" title="Download">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              </a>
              <button onClick={()=>delDocument(doc.id)} className="p-1.5 bg-red-50 text-red-500 rounded-lg hover:bg-red-100 flex-shrink-0" title="Verwijderen">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
              </button>
            </div>
          ))}
          {docs.length===0&&<p className="text-xs text-gray-400 italic">Nog geen documenten</p>}
        </div>
      )}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ AFSPRAKEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AfsprakenView = ({ afspraken, kinderen, trajecten, organisaties, setModal, onDelAfspraak }) => {
  const [confirm, setConfirm] = useState(null);
  const [filter, setFilter] = useState('aankomend');
  const now = new Date();
  // FIX 6: guard op lege/ongeldige datum
  const toDate = (a) => { if(!a.datum) return new Date(0); const d = new Date(a.datum+'T'+(a.tijd||'00:00')); return isNaN(d)?new Date(0):d; };
  const sorted = [...afspraken].sort((a,b)=>toDate(a)-toDate(b));
  const aankomend = sorted.filter(a=>toDate(a)>=now&&a.status!=='geannuleerd');
  const geweest   = sorted.filter(a=>toDate(a)<now||a.status==='geannuleerd').reverse();
  const list = filter==='aankomend'?aankomend:geweest;
  const sCls = {gepland:'bg-blue-50 text-blue-700 border-blue-200',geweest:'bg-green-50 text-green-700 border-green-200',verzet:'bg-orange-50 text-orange-700 border-orange-200',geannuleerd:'bg-red-50 text-red-700 border-red-200'};
  return (
    <div className="space-y-6 pb-24">
      <div className="flex justify-between items-center">
        <div><h1 className="text-3xl font-bold text-gray-900">Afspraken</h1><p className="text-gray-600 mt-1">Planning en overzicht</p></div>
        <button onClick={()=>setModal({type:'afspraak'})} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl shadow-lg">
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
        </button>
      </div>
      <div className="grid grid-cols-2 gap-3">
        <div className="bg-white p-4 rounded-2xl border-2 border-gray-100 text-center"><p className="text-3xl font-bold text-indigo-600">{aankomend.length}</p><p className="text-sm text-gray-600">Aankomend</p></div>
        <div className="bg-white p-4 rounded-2xl border-2 border-gray-100 text-center"><p className="text-3xl font-bold text-gray-500">{geweest.length}</p><p className="text-sm text-gray-600">Geweest</p></div>
      </div>
      <div className="flex bg-white rounded-2xl border-2 border-gray-100 p-1">
        {['aankomend','geweest'].map(f=>(
          <button key={f} onClick={()=>setFilter(f)} className={`flex-1 py-2 rounded-xl text-sm font-medium transition-colors ${filter===f?'bg-indigo-500 text-white':'text-gray-600'}`}>
            {f==='aankomend'?'üìÖ Aankomend':'üïê Geweest'}
          </button>
        ))}
      </div>
      <div className="space-y-4">
        {list.map(af=>{
          const kind = kinderen.find(k=>k.id===af.kind_id);
          const tr   = trajecten.find(t=>t.id===af.traject_id);
          const org  = organisaties.find(o=>o.id===af.organisatie_id);
          const d    = toDate(af);
          return (
            <div key={af.id} className="bg-white p-5 rounded-2xl border-2 border-gray-100 shadow-sm">
              <div className="flex items-start gap-4">
                <div className="bg-indigo-50 border-2 border-indigo-100 rounded-2xl p-3 text-center min-w-[52px] flex-shrink-0">
                  <p className="text-xs font-bold text-indigo-500 uppercase">{d.toLocaleDateString('nl-NL',{month:'short'})}</p>
                  <p className="text-2xl font-bold text-indigo-700 leading-none">{d.getDate()}</p>
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-start justify-between gap-2 mb-1">
                    <h3 className="font-bold text-gray-900 leading-tight">{af.titel}</h3>
                    <span className={`text-xs px-2 py-1 rounded-full border font-medium flex-shrink-0 ${sCls[af.status]||sCls.gepland}`}>{af.status||'gepland'}</span>
                  </div>
                  {af.tijd&&<p className="text-sm text-gray-600">üïê {af.tijd}</p>}
                  {af.locatie&&<p className="text-sm text-gray-600">üìç {af.locatie}</p>}
                  {kind&&<p className="text-sm text-gray-600">üë§ {kind.naam}</p>}
                  {tr&&<p className="text-sm text-gray-500">üìã {tr.naam}</p>}
                  {org&&<p className="text-sm text-gray-500">üè¢ {org.naam}</p>}
                  {af.wie&&<p className="text-sm text-gray-500">üë• {af.wie}</p>}
                  {af.notities&&<p className="text-sm text-gray-500 italic mt-2 pt-2 border-t border-gray-100">{af.notities}</p>}
                  {af.verslag&&<div className="mt-2 pt-2 border-t border-gray-100"><p className="text-xs font-semibold text-gray-500 mb-1">VERSLAG</p><p className="text-sm text-gray-700">{af.verslag}</p></div>}
                </div>
              </div>
              <div className="flex gap-2 mt-4 pt-3 border-t border-gray-100">
                <button onClick={()=>setModal({type:'afspraak',data:af})} className="flex-1 py-2 bg-indigo-50 text-indigo-700 rounded-xl text-sm font-medium hover:bg-indigo-100 border border-indigo-200">Bewerken</button>
                <button onClick={()=>setConfirm(af)} className="py-2 px-4 bg-red-50 text-red-500 rounded-xl text-sm font-medium hover:bg-red-100 border border-red-200">
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </div>
          );
        })}
      </div>
      {list.length===0&&<EmptyState msg={filter==='aankomend'?'Geen aankomende afspraken':'Geen afspraken geweest'} onAdd={filter==='aankomend'?()=>setModal({type:'afspraak'}):null} btnTxt="Plan eerste afspraak"/>}
      {confirm&&<ConfirmDialog msg={`Afspraak "${confirm.titel}" verwijderen?`} onCancel={()=>setConfirm(null)} onOk={async()=>{await onDelAfspraak(confirm.id);setConfirm(null);}}/>}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ ORGANISATIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const OrganisatiesView = ({ organisaties, trajecten, setModal, onDelOrg }) => {
  const [confirm, setConfirm] = useState(null);
  const tCls = {Gemeente:'bg-blue-50 text-blue-700 border-blue-200',Zorginstelling:'bg-green-50 text-green-700 border-green-200',School:'bg-yellow-50 text-yellow-700 border-yellow-200',Ziekenhuis:'bg-red-50 text-red-700 border-red-200',Verzekeraar:'bg-purple-50 text-purple-700 border-purple-200',Thuiszorg:'bg-teal-50 text-teal-700 border-teal-200',GGZ:'bg-pink-50 text-pink-700 border-pink-200',MEE:'bg-orange-50 text-orange-700 border-orange-200',Wijkteam:'bg-indigo-50 text-indigo-700 border-indigo-200',Anders:'bg-gray-50 text-gray-700 border-gray-200'};
  return (
    <div className="space-y-6 pb-24">
      <div className="flex justify-between items-center">
        <div><h1 className="text-3xl font-bold text-gray-900">Organisaties</h1><p className="text-gray-600 mt-1">Instanties en contacten</p></div>
        <button onClick={()=>setModal({type:'organisatie'})} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-3 rounded-2xl shadow-lg">
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
        </button>
      </div>
      {organisaties.length>0&&(
        <div className="bg-white rounded-2xl border-2 border-gray-100 p-4">
          <p className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3">Per type</p>
          <div className="flex flex-wrap gap-2">
            {[...new Set(organisaties.map(o=>o.type).filter(Boolean))].map(tp=>(
              <span key={tp} className={`text-xs px-3 py-1 rounded-full font-medium border ${tCls[tp]||tCls.Anders}`}>{tp} ({organisaties.filter(o=>o.type===tp).length})</span>
            ))}
          </div>
        </div>
      )}
      <div className="grid gap-4">
        {organisaties.map(org=>{
          const tc = trajecten.filter(t=>(t.organisatie_ids||[]).includes(org.id)).length;
          return (
            <div key={org.id} className="bg-white p-5 rounded-2xl border-2 border-gray-100 shadow-sm">
              <div className="flex justify-between items-start">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 flex-wrap mb-2">
                    <h3 className="font-bold text-lg text-gray-900">{org.naam}</h3>
                    {org.type&&<span className={`text-xs px-2 py-1 rounded-full font-medium border ${tCls[org.type]||tCls.Anders}`}>{org.type}</span>}
                  </div>
                  {org.contactpersoon&&<p className="text-sm text-gray-600">üë§ {org.contactpersoon}</p>}
                  {org.telefoon&&<p className="text-sm text-gray-600">üìû {org.telefoon}</p>}
                  {org.email&&<p className="text-sm text-gray-600">‚úâÔ∏è {org.email}</p>}
                  {org.notities&&<p className="text-sm text-gray-500 italic mt-2">{org.notities}</p>}
                  {tc>0&&<p className="text-xs text-gray-400 mt-2">Betrokken bij <span className="font-semibold text-indigo-600">{tc} traject{tc!==1?'en':''}</span></p>}
                </div>
                <div className="flex gap-2 ml-3 flex-shrink-0">
                  <button onClick={()=>setModal({type:'organisatie',data:org})} className="p-2 text-indigo-600 bg-indigo-50 rounded-xl border border-indigo-200 hover:bg-indigo-100">
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                  </button>
                  <button onClick={()=>setConfirm(org)} className="p-2 text-red-500 bg-red-50 rounded-xl border border-red-200 hover:bg-red-100">
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  </button>
                </div>
              </div>
            </div>
          );
        })}
      </div>
      {organisaties.length===0&&<EmptyState msg="Nog geen organisaties toegevoegd" onAdd={()=>setModal({type:'organisatie'})} btnTxt="Voeg eerste toe"/>}
      {confirm&&<ConfirmDialog msg={`"${confirm.naam}" verwijderen?`} onCancel={()=>setConfirm(null)} onOk={async()=>{await onDelOrg(confirm.id);setConfirm(null);}}/>}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ GEDEELDE COMPONENTEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const EmptyState = ({ msg, onAdd, btnTxt }) => (
  <div className="text-center py-16 bg-gradient-to-br from-gray-50 to-indigo-50 rounded-2xl border-2 border-dashed border-gray-300">
    <p className="text-xl font-semibold text-gray-900 mb-2">{msg}</p>
    {onAdd&&<button onClick={onAdd} className="mt-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-xl font-medium shadow-lg">{btnTxt}</button>}
  </div>
);

const ConfirmDialog = ({ msg, onCancel, onOk }) => (
  <div className="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
    <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full">
      <p className="text-gray-800 font-medium mb-6">{msg}</p>
      <div className="flex gap-3">
        <button onClick={onCancel} className="flex-1 py-3 border-2 border-gray-200 text-gray-700 rounded-xl font-medium">Annuleren</button>
        <button onClick={onOk} className="flex-1 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600">Verwijderen</button>
      </div>
    </div>
  </div>
);

// ‚îÄ‚îÄ‚îÄ NAVIGATIE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BottomNav = ({ view, setView }) => {
  const items = [
    {id:'dashboard',   label:'Dashboard',  d:'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'},
    {id:'kinderen',    label:'Kinderen',   d:'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'},
    {id:'trajecten',   label:'Trajecten',  d:'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'},
    {id:'afspraken',   label:'Afspraken',  d:'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'},
    {id:'organisaties',label:'Instanties', d:'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4'},
  ];
  return (
    <div className="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-100 shadow-2xl z-40">
      <div className="max-w-2xl mx-auto flex justify-around px-1">
        {items.map(item=>{
          const active = view===item.id;
          return (
            <button key={item.id} onClick={()=>setView(item.id)} className={`flex flex-col items-center py-2 px-2 transition-all ${active?'text-indigo-600':'text-gray-500'}`}>
              <div className={`p-1.5 rounded-xl ${active?'bg-indigo-100':''}`}>
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={item.d}/></svg>
              </div>
              <span className={`text-xs mt-0.5 font-medium ${active?'text-indigo-600':'text-gray-500'}`}>{item.label}</span>
            </button>
          );
        })}
      </div>
    </div>
  );
};

const FAB = ({ setModal, view }) => {
  const [open, setOpen] = useState(false);
  if (view==='organisaties') return <div className="fixed bottom-24 right-6 z-30"><button onClick={()=>setModal({type:'organisatie'})} className="w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full shadow-2xl flex items-center justify-center"><svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg></button></div>;
  if (view==='afspraken')    return <div className="fixed bottom-24 right-6 z-30"><button onClick={()=>setModal({type:'afspraak'})}    className="w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full shadow-2xl flex items-center justify-center"><svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg></button></div>;
  return (
    <div className="fixed bottom-24 right-6 z-30">
      {open&&(
        <div className="absolute bottom-16 right-0 bg-white rounded-2xl shadow-2xl border-2 border-gray-100 p-2 space-y-1 min-w-[180px]">
          {[{type:'actiepunt',label:'Actiepunt',color:'text-purple-600'},{type:'traject',label:'Traject',color:'text-indigo-600'}].map(x=>(
            <button key={x.type} onClick={()=>{setModal({type:x.type});setOpen(false);}} className="w-full flex items-center gap-3 px-4 py-3 hover:bg-indigo-50 rounded-xl text-left">
              <svg className={`w-5 h-5 ${x.color}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
              <span className="font-medium text-gray-900">{x.label}</span>
            </button>
          ))}
        </div>
      )}
      <button onClick={()=>setOpen(!open)} className={`w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full shadow-2xl flex items-center justify-center transition-transform ${open?'rotate-45':''}`}>
        <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
      </button>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ MODAL MANAGER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ModalManager = ({ modal, setModal, currentUser, kinderen, trajecten, organisaties, saveKind, saveTraject, saveActiepunt, saveOrganisatie, saveAfspraak, saveHeaderFoto, headerFoto }) => {
  const close = () => setModal(null);
  if (modal.type==='kind')        return <KindModal       kind={modal.data}       onClose={close} onSave={saveKind}        currentUser={currentUser}/>;
  if (modal.type==='traject')     return <TrajectModal    traject={modal.data}    onClose={close} onSave={saveTraject}     currentUser={currentUser} kinderen={kinderen} organisaties={organisaties}/>;
  if (modal.type==='actiepunt')   return <ActiepuntModal  actiepunt={modal.data}  onClose={close} onSave={saveActiepunt}   currentUser={currentUser} trajecten={trajecten} kinderen={kinderen}/>;
  if (modal.type==='organisatie') return <OrgModal        org={modal.data}        onClose={close} onSave={saveOrganisatie} currentUser={currentUser}/>;
  if (modal.type==='afspraak')    return <AfspraakModal   afspraak={modal.data}   onClose={close} onSave={saveAfspraak}    currentUser={currentUser} kinderen={kinderen} trajecten={trajecten} organisaties={organisaties}/>;
  if (modal.type==='headerFoto')  return <HeaderFotoModal                         onClose={close} onSave={saveHeaderFoto}  headerFoto={headerFoto}/>;
  return null;
};

// ‚îÄ‚îÄ‚îÄ KIND MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const KindModal = ({ kind, onClose, onSave, currentUser }) => {
  const [fd, setFd] = useState(kind||{id:Date.now().toString(),naam:'',geboortedatum:'',notities:'',foto:'',aangemaakt_door:currentUser.naam,aangemaakt_op:new Date().toISOString()});
  const [fotoLoading, setFotoLoading] = useState(false);
  const uploadFoto = (e) => {
    const f=e.target.files[0]; if(!f) return;
    if(f.size>20*1024*1024){alert('Foto te groot (max 20MB)');return;}
    setFotoLoading(true);
    const r=new FileReader();
    r.onload=ev=>{setFd(p=>({...p,foto:ev.target.result}));setFotoLoading(false);};
    r.onerror=()=>{alert('Fout bij laden foto');setFotoLoading(false);};
    r.readAsDataURL(f);
  };
  const save = async () => { if(!fd.naam) return; if(await onSave(fd)) onClose(); };
  return (
    <ModalWrap onClose={onClose} title={kind?'Bewerk kind':'Nieuw kind'}>
      <div className="space-y-5">
        <div className="flex justify-center">
          <div className="relative">
            <div className="w-28 h-28 rounded-2xl overflow-hidden bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center border-4 border-white shadow-lg">
              {fotoLoading?<div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"/>
                :fd.foto?<img src={fd.foto} alt="Kind" className="w-full h-full object-cover"/>
                :<svg className="w-14 h-14 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>}
            </div>
            <label className="absolute bottom-0 right-0 bg-indigo-600 text-white p-2 rounded-full cursor-pointer hover:bg-indigo-700 shadow-lg">
              <input type="file" accept="image/*" onChange={uploadFoto} className="hidden" disabled={fotoLoading}/>
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
            </label>
            {fd.foto&&!fotoLoading&&<button onClick={()=>setFd({...fd,foto:''})} className="absolute top-0 right-0 bg-red-500 text-white p-1.5 rounded-full shadow-lg"><svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button>}
          </div>
        </div>
        <div><label className={labelCls}>Naam *</label><input type="text" value={fd.naam} onChange={e=>setFd({...fd,naam:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>Geboortedatum</label><input type="date" value={fd.geboortedatum} onChange={e=>setFd({...fd,geboortedatum:e.target.value})} className={inputSmCls}/></div>
        <div><label className={labelCls}>Notities</label><textarea value={fd.notities} onChange={e=>setFd({...fd,notities:e.target.value})} placeholder="Telefoonnummers, bijzonderheden..." className={inputCls+" resize-none"} rows={4}/></div>
        <button onClick={save} disabled={!fd.naam} className={btnPrimary+" disabled:opacity-50"}>Opslaan</button>
      </div>
    </ModalWrap>
  );
};

// ‚îÄ‚îÄ‚îÄ TRAJECT MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TrajectModal = ({ traject, kinderen, organisaties, onClose, onSave, currentUser }) => {
  const [fd, setFd] = useState(traject||{id:Date.now().toString(),naam:'',kind_id:'',organisatie_ids:[],status:'actief',startdatum:new Date().toISOString().split('T')[0],omschrijving:'',aangemaakt_door:currentUser.naam,aangemaakt_op:new Date().toISOString()});
  const toggleOrg = id => { const ids=fd.organisatie_ids||[]; setFd({...fd,organisatie_ids:ids.includes(id)?ids.filter(i=>i!==id):[...ids,id]}); };
  const save = async () => { if(!fd.naam||!fd.kind_id) return; if(await onSave(fd)) onClose(); };
  return (
    <ModalWrap onClose={onClose} title={traject?'Bewerk traject':'Nieuw traject'}>
      <div className="space-y-5">
        <div><label className={labelCls}>Naam traject *</label><input type="text" placeholder="bijv. Rolstoel aanvraag" value={fd.naam} onChange={e=>setFd({...fd,naam:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>Voor kind *</label>
          <select value={fd.kind_id} onChange={e=>setFd({...fd,kind_id:e.target.value})} className={inputCls}>
            <option value="">Selecteer kind</option>
            {kinderen.map(k=><option key={k.id} value={k.id}>{k.naam}</option>)}
          </select>
        </div>
        <div>
          <label className={labelCls}>Betrokken organisaties</label>
          {organisaties.length===0
            ?<p className="text-sm text-gray-400 italic px-4 py-3 border-2 border-dashed border-gray-200 rounded-xl">Voeg eerst organisaties toe via het tabblad Instanties.</p>
            :<div className="border-2 border-gray-200 rounded-xl p-3 max-h-48 overflow-y-auto space-y-1">
              {organisaties.map(o=>{
                const sel=(fd.organisatie_ids||[]).includes(o.id);
                return (<label key={o.id} className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer ${sel?'bg-indigo-50':'hover:bg-gray-50'}`}>
                  <input type="checkbox" checked={sel} onChange={()=>toggleOrg(o.id)} className="w-4 h-4 text-indigo-600 rounded"/>
                  <span className="text-sm font-medium text-gray-900 flex-1">{o.naam}</span>
                  {o.type&&<span className="text-xs text-gray-400">{o.type}</span>}
                </label>);
              })}
            </div>}
        </div>
        <div><label className={labelCls}>Omschrijving</label><textarea value={fd.omschrijving} onChange={e=>setFd({...fd,omschrijving:e.target.value})} className={inputCls+" resize-none"} rows={3}/></div>
        <button onClick={save} disabled={!fd.naam||!fd.kind_id} className={btnPrimary+" disabled:opacity-50"}>Opslaan</button>
      </div>
    </ModalWrap>
  );
};

// ‚îÄ‚îÄ‚îÄ ACTIEPUNT MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// FIX 2: id apart behandeld zodat spread volgorde niet uitmaakt
const ActiepuntModal = ({ actiepunt, trajecten, kinderen, onClose, onSave, currentUser }) => {
  const isNew = !actiepunt?.omschrijving;
  const [fd, setFd] = useState({
    id: actiepunt?.id || Date.now().toString(),
    traject_id: actiepunt?.traject_id || '',
    omschrijving: actiepunt?.omschrijving || '',
    eigenaar: actiepunt?.eigenaar || 'wij',
    toegewezen_aan: actiepunt?.toegewezen_aan || 'JJ',
    deadline: actiepunt?.deadline || '',
    status: actiepunt?.status || 'open',
    prioriteit: actiepunt?.prioriteit || 'normaal',
    notities: actiepunt?.notities || '',
    aangemaakt_door: actiepunt?.aangemaakt_door || currentUser.naam,
    aangemaakt_op: actiepunt?.aangemaakt_op || new Date().toISOString(),
  });
  const save = async () => {
    if(!fd.traject_id||!fd.omschrijving){alert('Vul een traject en omschrijving in.');return;}
    if(await onSave(fd)) onClose();
  };
  return (
    <ModalWrap onClose={onClose} title={isNew?'Nieuw actiepunt':'Bewerk actiepunt'}>
      <div className="space-y-5">
        <div><label className={labelCls}>Traject *</label>
          <select value={fd.traject_id} onChange={e=>setFd({...fd,traject_id:e.target.value})} className={inputCls}>
            <option value="">Selecteer traject</option>
            {trajecten.filter(t=>t.status!=='afgesloten').map(t=>{const k=kinderen.find(k=>k.id===t.kind_id);return <option key={t.id} value={t.id}>{t.naam}{k?' ('+k.naam+')':''}</option>;})}
          </select>
        </div>
        <div><label className={labelCls}>Omschrijving *</label><textarea value={fd.omschrijving} onChange={e=>setFd({...fd,omschrijving:e.target.value})} placeholder="Wat moet er gedaan worden?" className={inputCls+" resize-none"} rows={3}/></div>
        <div><label className={labelCls}>Eigenaar</label>
          <select value={fd.eigenaar} onChange={e=>setFd({...fd,eigenaar:e.target.value})} className={inputCls}>
            <option value="wij">Wij</option><option value="zij">Zij (instantie)</option>
          </select>
        </div>
        {fd.eigenaar==='wij'&&<div><label className={labelCls}>Toegewezen aan</label>
          <select value={fd.toegewezen_aan} onChange={e=>setFd({...fd,toegewezen_aan:e.target.value})} className={inputCls}>
            <option value="JJ">JJ</option><option value="Linda">Linda</option><option value="Beide">Beide</option>
          </select>
        </div>}
        <div><label className={labelCls}>Deadline</label>
          <input type="date" value={fd.deadline} onChange={e=>setFd({...fd,deadline:e.target.value})} className={inputCls}/>
        </div>
        <div><label className={labelCls}>Prioriteit</label>
          <select value={fd.prioriteit} onChange={e=>setFd({...fd,prioriteit:e.target.value})} className={inputCls}>
            <option value="laag">Laag</option><option value="normaal">Normaal</option><option value="hoog">Hoog</option>
          </select>
        </div>
        <button onClick={save} className={btnPrimary}>Opslaan</button>
      </div>
    </ModalWrap>
  );
};

// ‚îÄ‚îÄ‚îÄ ORGANISATIE MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const OrgModal = ({ org, onClose, onSave, currentUser }) => {
  const [fd, setFd] = useState(org||{id:Date.now().toString(),naam:'',type:'',contactpersoon:'',telefoon:'',email:'',notities:'',aangemaakt_door:currentUser.naam,aangemaakt_op:new Date().toISOString()});
  const save = async () => { if(!fd.naam) return; if(await onSave(fd)) onClose(); };
  return (
    <ModalWrap onClose={onClose} title={org?'Bewerk organisatie':'Nieuwe organisatie'}>
      <div className="space-y-5">
        <div><label className={labelCls}>Naam *</label><input type="text" placeholder="bijv. Gemeente Groningen" value={fd.naam} onChange={e=>setFd({...fd,naam:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>Type</label>
          <select value={fd.type} onChange={e=>setFd({...fd,type:e.target.value})} className={inputCls}>
            <option value="">Selecteer type</option>
            {ORG_TYPES.map(t=><option key={t} value={t}>{t}</option>)}
          </select>
        </div>
        <div><label className={labelCls}>Contactpersoon</label><input type="text" value={fd.contactpersoon} onChange={e=>setFd({...fd,contactpersoon:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>Telefoon</label><input type="tel" value={fd.telefoon} onChange={e=>setFd({...fd,telefoon:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>E-mail</label><input type="email" value={fd.email} onChange={e=>setFd({...fd,email:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>Notities</label><textarea value={fd.notities} onChange={e=>setFd({...fd,notities:e.target.value})} className={inputCls+" resize-none"} rows={3}/></div>
        <button onClick={save} disabled={!fd.naam} className={btnPrimary+" disabled:opacity-50"}>Opslaan</button>
      </div>
    </ModalWrap>
  );
};

// ‚îÄ‚îÄ‚îÄ AFSPRAAK MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// FIX 1: datumTekst correct initialiseren vanuit bestaande datum
const AfspraakModal = ({ afspraak, kinderen, trajecten, organisaties, onClose, onSave, currentUser }) => {
  const [fd, setFd] = useState(() => {
    const base = afspraak || {};
    return {
      id: base.id || Date.now().toString(),
      titel: base.titel || '',
      datum: base.datum || '',
      tijd: base.tijd || '',
      locatie: base.locatie || '',
      kind_id: base.kind_id || '',
      traject_id: base.traject_id || '',
      organisatie_id: base.organisatie_id || '',
      wie: base.wie || 'Beide',
      status: base.status || 'gepland',
      notities: base.notities || '',
      verslag: base.verslag || '',
      aangemaakt_door: base.aangemaakt_door || currentUser.naam,
      aangemaakt_op: base.aangemaakt_op || new Date().toISOString(),
    };
  });
  const filtTraj = fd.kind_id ? trajecten.filter(t=>t.kind_id===fd.kind_id&&t.status!=='afgesloten') : trajecten.filter(t=>t.status!=='afgesloten');
  const save = async () => {
    if(!fd.titel||!fd.datum){alert('Vul minimaal een titel en datum in.');return;}
    if(await onSave(fd)) onClose();
  };
  return (
    <ModalWrap onClose={onClose} title={afspraak?'Bewerk afspraak':'Nieuwe afspraak'}>
      <div className="space-y-4">
        <div><label className={labelCls}>Onderwerp / titel *</label><input type="text" placeholder="bijv. Gesprek met behandelaar" value={fd.titel} onChange={e=>setFd({...fd,titel:e.target.value})} className={inputCls}/></div>
        <div>
          <label className={labelCls}>Datum *</label>
          <input type="date" value={fd.datum} onChange={e=>setFd({...fd, datum:e.target.value})} className={inputCls}/>
        </div>
        <div>
          <label className={labelCls}>Tijdstip</label>
          <input type="time" value={fd.tijd} onChange={e=>setFd({...fd,tijd:e.target.value})} className={inputCls}/>
        </div>
        <div><label className={labelCls}>Locatie</label><input type="text" placeholder="Adres of videobellen" value={fd.locatie} onChange={e=>setFd({...fd,locatie:e.target.value})} className={inputCls}/></div>
        <div><label className={labelCls}>Kind</label>
          <select value={fd.kind_id} onChange={e=>setFd({...fd,kind_id:e.target.value,traject_id:''})} className={inputCls}>
            <option value="">Selecteer kind (optioneel)</option>
            {kinderen.map(k=><option key={k.id} value={k.id}>{k.naam}</option>)}
          </select>
        </div>
        <div><label className={labelCls}>Traject</label>
          <select value={fd.traject_id} onChange={e=>setFd({...fd,traject_id:e.target.value})} className={inputCls}>
            <option value="">Selecteer traject (optioneel)</option>
            {filtTraj.map(t=><option key={t.id} value={t.id}>{t.naam}</option>)}
          </select>
        </div>
        <div><label className={labelCls}>Organisatie</label>
          <select value={fd.organisatie_id} onChange={e=>setFd({...fd,organisatie_id:e.target.value})} className={inputCls}>
            <option value="">Selecteer organisatie (optioneel)</option>
            {organisaties.map(o=><option key={o.id} value={o.id}>{o.naam}</option>)}
          </select>
        </div>
        <div><label className={labelCls}>Wie gaat mee</label>
          <select value={fd.wie} onChange={e=>setFd({...fd,wie:e.target.value})} className={inputCls}>
            <option value="JJ">JJ</option><option value="Linda">Linda</option><option value="Beide">Beide</option>
          </select>
        </div>
        <div><label className={labelCls}>Status</label>
          <select value={fd.status} onChange={e=>setFd({...fd,status:e.target.value})} className={inputCls}>
            <option value="gepland">Gepland</option><option value="geweest">Geweest</option>
            <option value="verzet">Verzet</option><option value="geannuleerd">Geannuleerd</option>
          </select>
        </div>
        <div><label className={labelCls}>Voorbereiding / notities</label><textarea value={fd.notities} onChange={e=>setFd({...fd,notities:e.target.value})} placeholder="Wat wil je bespreken of meenemen?" className={inputCls+" resize-none"} rows={3}/></div>
        <div><label className={labelCls}>Verslag (na afloop)</label><textarea value={fd.verslag} onChange={e=>setFd({...fd,verslag:e.target.value})} placeholder="Wat is er besproken? Wat zijn de uitkomsten?" className={inputCls+" resize-none"} rows={3}/></div>
        <button onClick={save} className={btnPrimary}>Opslaan</button>
      </div>
    </ModalWrap>
  );
};

// ‚îÄ‚îÄ‚îÄ HEADER FOTO MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const HeaderFotoModal = ({ onClose, onSave, headerFoto }) => {
  const [foto, setFoto] = useState(headerFoto);
  const [loading, setLoading] = useState(false);
  const upload = (e) => {
    const f=e.target.files[0]; if(!f) return;
    if(f.size>20*1024*1024){alert('Foto te groot (max 20MB)');return;}
    setLoading(true);
    const r=new FileReader();
    r.onload=ev=>{setFoto(ev.target.result);setLoading(false);};
    r.onerror=()=>{alert('Fout bij laden foto');setLoading(false);};
    r.readAsDataURL(f);
  };
  return (
    <ModalWrap onClose={onClose} title="Header foto">
      <div className="space-y-5">
        <div className="relative w-full">
          <div className="w-full h-44 rounded-2xl overflow-hidden bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center">
            {loading?<div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"/>
              :foto?<img src={foto} alt="Header" className="w-full h-full object-cover"/>
              :<p className="text-sm text-gray-500">Upload een gezinsfoto</p>}
          </div>
          <label className="absolute bottom-3 right-3 bg-indigo-600 text-white p-3 rounded-full cursor-pointer hover:bg-indigo-700 shadow-lg">
            <input type="file" accept="image/*" onChange={upload} className="hidden" disabled={loading}/>
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>
          </label>
          {foto&&!loading&&<button onClick={()=>setFoto('')} className="absolute top-3 right-3 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 shadow-lg"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button>}
        </div>
        <div className="flex gap-3">
          <button onClick={onClose} className="flex-1 py-3 border-2 border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50">Annuleren</button>
          <button onClick={async()=>{if(await onSave(foto)) onClose();}} className={btnPrimary+" flex-1"}>Opslaan</button>
        </div>
      </div>
    </ModalWrap>
  );
};

ReactDOM.render(<App/>, document.getElementById('root'));
```

  </script>
</body>
</html>